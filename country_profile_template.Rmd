---
author: 
  name: "Seafood Globalization Lab"
  email: "gephart@uw.edu"
  affiliation: "School of Aquatic and Fishery Sciences, University of Washington"
  orcid: "0000-0000-0000-0000"
date: "2024-04-19"
updated: "`r Sys.Date()`"
output:
    html_document: 
      self-contained: true
editor_options: 
  chunk_output_type: console
---

```{r setup}
#| include: false

# set code chunk defaults for document
knitr::opts_chunk$set(cache = TRUE, 
                      cache.lazy = FALSE, 
                      include = FALSE)
# load packages
library(rmarkdown)
#library(quarto)
library(knitr) # Need package version 1.44 or up for quarto
library(countrycode)
library(magrittr)

# temporary variables - paramaterize report later - AM 2024-04-29
a_country <- "Belize"
year_int <- 2019

```

---
title: "Oceana Distant Water Fishing Report: `r a_country`"
---

# Introduction

This report provides an analysis of `r a_country` distant water fishing.

# Data Analysis

```{r clean_data}

source(file.path(".","scripts", "clean_data.R", fsep = "/"))
```

```{r}
# Get country iso3 character value to filter data
an_iso3c <- countrycode(a_country,
                       origin = "country.name",
                       destination = "iso3c")

# filter artis eez for country and year of interest
an_artis_eez <- artis_eez %>% 
  filter(source_country_iso3c == an_iso3c,
         year == year_int)

```

## Landings mass check
```{r}
# landings mass check - filter
artis_sau_check <- artis_sau %>% 
  filter(habitat == "marine", 
         method == "capture", 
         year == year_int, 
         source_country_iso3c == "CHN")

# e^-6 or e^-9 considered 0 - haven't gained or lost any mass
mass_diff <- sum(an_artis_eez$live_weight_t) - sum(artis_sau_check$live_weight_t)

nrow_artis_eez <- nrow(an_artis_eez) 
```

The difference between ARTIS live weight (tons) and SAU live weight (tons) is `r mass_diff`.

The number of rows in ARTIS EEZ is `r nrow_artis_eez`. 


```{r}
#| echo: TRUE

# print top 25 DWF species
top_25 <- an_artis_eez %>% 
  filter(dwf == "foreign") %>%
  group_by(sciname) %>%
  summarise(live_weight_t = sum(live_weight_t)) %>%
  arrange(desc(live_weight_t)) %>%
  slice_head(n = 25) # limits df to first 25 rows

knitr::kable(
  top_25, caption = 'Top 25 DWF Species'
)
```

### `r top_25[[1,1]]`

```{r}
#| include: true
#| echo: false

# plot artis_sau$source_country_iso3c (without catch eez information)
an_artis_eez %>%
 # select(-source_country_iso3c) %>%
 # rename("source_country_iso3c" = "catch_artis_iso3") %>%
  filter(sciname == top_25[[1,1]]) %>%
  plot_sankey()
```

```{r}
#| include: true
#| echlo: false

# plot with catch eez information
an_artis_eez %>%
  select(-source_country_iso3c) %>%
  rename("source_country_iso3c" = "catch_artis_iso3") %>%
  filter(sciname == top_25[[1,1]]) %>%
  plot_sankey()
```




